VERSION 5.00
Begin VB.Form Form1 
   BorderStyle     =   0  'None
   Caption         =   "Ronda por Enrique Somolinos Pérez"
   ClientHeight    =   7845
   ClientLeft      =   0
   ClientTop       =   0
   ClientWidth     =   10755
   LinkTopic       =   "Form1"
   MDIChild        =   -1  'True
   ScaleHeight     =   7845
   ScaleWidth      =   10755
   ShowInTaskbar   =   0   'False
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   16
      Left            =   9480
      Picture         =   "Form1.frx":0000
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   28
      Top             =   6120
      Visible         =   0   'False
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   15
      Left            =   9480
      Picture         =   "Form1.frx":5142
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   27
      Top             =   240
      Visible         =   0   'False
      Width           =   1065
   End
   Begin VB.PictureBox j2 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   1
      Left            =   1800
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   9
      Top             =   240
      Width           =   1065
   End
   Begin VB.PictureBox j2 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   2
      Left            =   3240
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   8
      Top             =   240
      Width           =   1065
   End
   Begin VB.PictureBox j2 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   3
      Left            =   4680
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   7
      Top             =   240
      Width           =   1065
   End
   Begin VB.PictureBox j1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   1
      Left            =   1920
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   4
      Top             =   6000
      Width           =   1065
   End
   Begin VB.PictureBox j1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   2
      Left            =   3360
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   5
      Top             =   6000
      Width           =   1065
   End
   Begin VB.PictureBox j1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   3
      Left            =   4800
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   6
      Top             =   6000
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   10
      Left            =   8880
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   20
      Top             =   3984
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   8
      Left            =   7275
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   18
      Top             =   3984
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   5
      Left            =   840
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   15
      Top             =   3984
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   13
      Left            =   5670
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   14
      Top             =   3984
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   3
      Left            =   4050
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   3
      Top             =   3984
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   2
      Left            =   2445
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   2
      Top             =   3984
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   12
      Left            =   9600
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   22
      Top             =   2235
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   11
      Left            =   8040
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   21
      Top             =   2235
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   9
      Left            =   6480
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   19
      Top             =   2235
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   7
      Left            =   240
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   17
      Top             =   2280
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   6
      Left            =   4920
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   16
      Top             =   2235
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   1
      Left            =   3360
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   1
      Top             =   2235
      Width           =   1065
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   4
      Left            =   1800
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   0
      Top             =   2235
      Width           =   1065
   End
   Begin VB.Timer tinicio 
      Interval        =   2
      Left            =   240
      Top             =   3840
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   14
      Left            =   8880
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   26
      Top             =   6120
      Visible         =   0   'False
      Width           =   1065
   End
   Begin VB.TextBox tjug 
      Alignment       =   2  'Center
      BorderStyle     =   0  'None
      Height          =   375
      Index           =   2
      Left            =   6360
      Locked          =   -1  'True
      TabIndex        =   25
      Top             =   840
      Width           =   1815
   End
   Begin VB.TextBox tjug 
      Alignment       =   2  'Center
      BorderStyle     =   0  'None
      Height          =   375
      Index           =   1
      Left            =   6480
      Locked          =   -1  'True
      TabIndex        =   24
      Top             =   7080
      Width           =   1815
   End
   Begin VB.Timer Timer1 
      Interval        =   200
      Left            =   600
      Top             =   7320
   End
   Begin VB.PictureBox picture1 
      AutoSize        =   -1  'True
      BackColor       =   &H00C0C0C0&
      BorderStyle     =   0  'None
      Height          =   1440
      Index           =   0
      Left            =   8640
      ScaleHeight     =   1440
      ScaleWidth      =   1065
      TabIndex        =   23
      Top             =   240
      Visible         =   0   'False
      Width           =   1065
   End
   Begin VB.Shape Shape1 
      BackStyle       =   1  'Opaque
      Height          =   615
      Index           =   1
      Left            =   6360
      Shape           =   4  'Rounded Rectangle
      Top             =   6960
      Width           =   2175
   End
   Begin VB.Shape Shape1 
      BackStyle       =   1  'Opaque
      Height          =   615
      Index           =   0
      Left            =   6240
      Shape           =   4  'Rounded Rectangle
      Top             =   720
      Width           =   2175
   End
   Begin VB.Label lcartas 
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "Cartas: 0"
      Height          =   195
      Index           =   1
      Left            =   6480
      TabIndex        =   13
      Top             =   6480
      Width           =   630
   End
   Begin VB.Label lcartas 
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "Cartas: 0"
      Height          =   195
      Index           =   2
      Left            =   6480
      TabIndex        =   12
      Top             =   360
      Width           =   630
   End
   Begin VB.Line Line1 
      BorderWidth     =   5
      Index           =   1
      X1              =   0
      X2              =   10800
      Y1              =   1920
      Y2              =   1920
   End
   Begin VB.Line Line1 
      BorderWidth     =   5
      Index           =   0
      X1              =   0
      X2              =   10800
      Y1              =   5760
      Y2              =   5760
   End
   Begin VB.Label Label2 
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "Jugador 1"
      Height          =   195
      Left            =   360
      TabIndex        =   11
      Top             =   6600
      Width           =   705
   End
   Begin VB.Label Label1 
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "Ordenador"
      Height          =   195
      Left            =   360
      TabIndex        =   10
      Top             =   1320
      Width           =   750
   End
End
Attribute VB_Name = "Form1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Sub Form_Load()
Dim r As Integer
Randomize Timer
Form1.Top = 0
Form1.Left = 0


Call comenzar_juego
End Sub

Public Sub repetida(c As Integer, ByRef intento As Byte)

If intento = 1 Then cmesa(1) = cartas(c)
If intento = 2 Then cmesa(2) = cartas(c) Else GoTo g3
       
        If cmesa(1) Mod 13 = cmesa(2) Mod 13 Then intento = 1: GoTo fin

g3: If intento = 3 Then cmesa(3) = cartas(c) Else GoTo g4
          If cmesa(1) Mod 13 = cmesa(3) Mod 13 Or cmesa(2) Mod 13 = cmesa(3) Mod 13 Then intento = 2: GoTo fin

g4: If intento = 4 Then cmesa(4) = cartas(c) Else GoTo g5
      If cmesa(1) Mod 13 = cmesa(4) Mod 13 Or cmesa(2) Mod 13 = cmesa(4) Mod 13 Or _
             cmesa(3) Mod 13 = cmesa(4) Mod 13 Then intento = 3: GoTo fin

g5:

picture1(intento).Picture = LoadResPicture(cartas(c), 0)

mantener_cartas (c)
fin:
End Sub

Public Function generarcarta()
generarcarta = Int(Rnd(1) * total) + 1
End Function

Public Sub iniciar_jugadores()
Dim f, j, i As Byte
Dim x, y As Integer

If Proyecto1.acabado = 1 And nueva <> 1 Then Proyecto1.acabado = 0: Exit Sub
nueva = 0
acabado = 0
j2(1).Left = poscar(1, 1)
j2(1).Top = poscar(1, 2)
 j2(2).Left = poscar(2, 1)
j2(2).Top = poscar(2, 2)
j2(3).Left = poscar(3, 1)
j2(3).Top = poscar(3, 2)



caidahecha = -1
sobrecaida = -1
cartasobre = -1
ronda(1) = -1
ronda(2) = -1
rondin(1) = -1
rondin(2) = -1
rondapagada = False
ultimapuesta = -1
If total < 6 Then GoTo fin
For f = 1 To 3
Call generar_y_poner(j1(f), jugador1(f), False)
Next f

For f = 1 To 3
Call generar_y_poner(j2(f), jugador2(f), True)
Next f
Call comprobar_si_ronda_rondin(jugador1, rondin, ronda, 1)
Call comprobar_si_ronda_rondin(jugador2, rondin, ronda, 2)


For j = 1 To 2
If ronda(j) = 0 Then ronda(j) = 13
If rondin(j) = 0 Then rondin(j) = 13
If rondin(j) >= 0 Then tjug(j).Text = "Rondin" _
    Else: If ronda(j) >= 0 Then tjug(j).Text = "Ronda"
Next j
If rondin(1) > 0 And rondin(2) = -1 Then ccogidas(1) = ccogidas(1) + 2: ccogidas(2) = ccogidas(2) - 2: rondapagada = True: lcartas(1).Caption = "Cartas: " & ccogidas(1): For i = 1 To 2: picture1(15).Visible = True: x = picture1(15).Left: y = picture1(15).Top: Call mover_carta_a_otra(picture1(15), picture1(16), picture1(15).Left, picture1(15).Top): picture1(15).Visible = False: picture1(15).Left = x: picture1(15).Top = y: Next i Else _
    If rondin(2) > 0 And rondin(1) = -1 Then ccogidas(2) = ccogidas(2) + 2: ccogidas(1) = ccogidas(1) - 2: rondapagada = True: lcartas(2).Caption = "Cartas: " & ccogidas(2): For i = 1 To 2: picture1(16).Visible = True: x = picture1(16).Left: y = picture1(16).Top: Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y: Next i Else _
    If ronda(1) > 0 And rondin(2) = -1 And ronda(2) = -1 Then ccogidas(1) = ccogidas(1) + 1: ccogidas(2) = ccogidas(2) - 1: rondapagada = True: lcartas(1).Caption = "Cartas: " & ccogidas(1): picture1(15).Visible = True: x = picture1(15).Left: y = picture1(15).Top: Call mover_carta_a_otra(picture1(15), picture1(16), picture1(15).Left, picture1(15).Top): picture1(15).Visible = False: picture1(15).Left = x: picture1(15).Top = y Else _
    If ronda(2) > 0 And rondin(1) = -1 And ronda(1) = -1 Then ccogidas(2) = ccogidas(2) + 1: ccogidas(1) = ccogidas(1) - 1: rondapagada = True: lcartas(2).Caption = "Cartas: " & ccogidas(2): picture1(16).Visible = True: x = picture1(16).Left: y = picture1(16).Top: Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y


'jugador1(1) = 13
'jugador1(2) = 26
'jugador1(3) = 50

'jugador2(3) = 39
'jugador2(2) = 50


vicenteposible = 0
Call actualizar_marcador
Timer1.Enabled = True
fin:
End Sub

Public Sub mantener_cartas(ByVal c As Integer)
Dim carta As Byte

If total = 0 Then GoTo fin
For carta = c To total - 1
cartas(carta) = cartas(carta + 1)
Next
total = total - 1
fin:
End Sub

Public Sub generar_y_poner(ByVal destino As PictureBox, ByRef vardestino As Integer, tapado As Boolean)
Dim aux As Byte

Call retardo(800)

aux = generarcarta
vardestino = cartas(aux)

If Not (tapado) Then destino.Picture = LoadResPicture(cartas(aux), 0) _
    Else destino.Picture = picture1(15).Picture
mantener_cartas (aux)
End Sub





Private Sub j1_Click(Index As Integer)

Dim dado As Boolean
Dim cdado As Byte
Dim x3 As Integer
Dim y3 As Integer
Dim x4 As Integer
Dim y4 As Integer
Dim cart As Integer
Dim x, y, x2, y2, p As Integer
p = 0
cart = 0
x = j1(Index).Left
y = j1(Index).Top
x2 = picture1(cdado).Left
y2 = picture1(cdado).Top

If acabado = 1 Then GoTo fin
If vicenteposible = Index Then _
    tjug(1).Text = "San Vicente": Call mover_carta_a_otra(j1(Index), picture1(13), j1(Index).Left, j1(Index).Top): _
    ccogidas(1) = 52: ccogidas(2) = 0: acabado = 1: Call decir_ganador

'solo para sobrecaida
If caidahecha > 1 And caidahecha Mod 13 = jugador1(1) Mod 13 Then cart = 1 Else _
    If caidahecha > 1 And caidahecha Mod 13 = jugador1(2) Mod 13 Then cart = 2 Else _
        If caidahecha > 1 And caidahecha Mod 13 = jugador1(3) Mod 13 Then cart = 3
    
If cart > 0 And cartasobre > 0 Then Call comprobar_si_coges(jugador1(Index), cmesa, cdado, dado)
    If dado And cartasobre > 0 And cart > 0 Then _
            Call mover_carta_a_otra(j1(Index), picture1(cdado), j1(Index).Left, j1(Index).Top): _
            tjug(1).Text = "Sobrecaida": jugador2(cartasobre) = -1: _
            Call si_sanvicente(jugador1(Index), Index): If vicente = 0 Then _
            Call mover_carta_a_otra(j1(Index), picture1(16), j1(Index).Left, j1(Index).Top): _
            Call mover_carta_a_otra(picture1(cdado), picture1(16), picture1(cdado).Left, picture1(cdado).Top): _
            Call mover_carta_a_otra(j2(cartasobre), picture1(16), j2(cartasobre).Left, j2(cartasobre).Top): _
            j1(Index).Visible = False: j1(Index).Left = x:: j1(Index).Top = y: _
            j1(Index).Picture = picture1(0).Picture: _
            j2(cartasobre).Picture = picture1(0).Picture: _
            picture1(cdado).Visible = False: picture1(cdado).Left = x2: picture1(cdado).Top = y2: _
            picture1(cdado).Picture = picture1(0).Picture: picture1(cdado).Visible = True: _
            ultimabaza = 1: ultimapuesta = -1: caidahecha = -1: _
            turno = 1: Timer1.Enabled = True: _
            cmesa(cdado) = -1: _
            ccogidas(2) = ccogidas(2) - 2: lcartas(2) = "Cartas: " & ccogidas(2): _
            ccogidas(1) = ccogidas(1) + 5: lcartas(1) = "Cartas: " & ccogidas(1): _
            Call comprobar_si_siguiente(jugador1(Index), 1): _
            jugador1(Index) = -1: _
            For x2 = 1 To 2: _
            x = picture1(15).Left: y = picture1(15).Top: picture1(15).Visible = True: _
            Call mover_carta_a_otra(picture1(15), picture1(16), picture1(15).Left, picture1(15).Top): _
            picture1(15).Visible = False: picture1(15).Left = x: picture1(15).Top = y: _
            Next x2: Call colocar_cartas: If turno_acabado And total > 5 Then ncuelgue = 1: Call iniciar_jugadores: GoTo fin:



If turno <> 0 Then Timer1.Enabled = True: GoTo fin Else _
    Timer1.Enabled = False
If jugador1(Index) <= 0 Then GoTo fin
tjug(1).Text = ""
cturno(1) = 0

salidas(jugador1(Index) Mod 13) = salidas(jugador1(Index) Mod 13) + 1
turno = 1
Call comprobar_si_coges(jugador1(Index), cmesa, cdado, dado)
sobrecaida = -1
If dado Then Call mover_carta_a_otra(j1(Index), picture1(cdado), j1(Index).Left, j1(Index).Top): _
        Call mirar_si_caida(1, jugador1(Index)): _
        Call si_sobrecaida(jugador1(Index), Index, p, x3, y3): _
        If sobrecaida >= 0 Then Call si_sanvicente2(jugador1(Index), Index) Else _
        If sobrecaida = -1 Then _
        Call mover_carta_a_otra(j1(Index), picture1(14), picture1(cdado).Left, picture1(cdado).Top): _
        Call mover_carta_a_otra(picture1(cdado), picture1(14), picture1(cdado).Left, picture1(cdado).Top): _
        ultimapuesta = -1: _
        j1(Index).Visible = False: j1(Index).Left = x:: j1(Index).Top = y: _
        j1(Index).Picture = picture1(0).Picture: _
        picture1(cdado).Visible = False: picture1(cdado).Left = x2: picture1(cdado).Top = y2: _
        picture1(cdado).Picture = picture1(0).Picture: _
        picture1(cdado).Visible = True: _
        ultimabaza = 1: _
        ccogidas(1) = ccogidas(1) + 2: cturno(1) = cturno(1) + 2: lcartas(1).Caption = "Cartas: " & ccogidas(1): _
        cmesa(cdado) = -1: _
        Call comprobar_si_siguiente(jugador1(Index), 1) _
        
If dado And sobrecaida >= 0 Then tjug(2).Text = "Sobrecaida": _
        turno = 0: _
        Timer1.Enabled = False: sobrecaida = -1: _
        Call mover_carta_a_otra(j2(p), picture1(0), j2(p).Left, j2(p).Top): _
        Call mover_carta_a_otra(j1(Index), picture1(0), picture1(cdado).Left, picture1(cdado).Top): _
        Call mover_carta_a_otra(picture1(cdado), picture1(0), picture1(cdado).Left, picture1(cdado).Top): _
        j1(Index).Visible = False: j1(Index).Left = x:: j1(Index).Top = y: _
        j1(Index).Picture = picture1(0).Picture: _
        picture1(cdado).Visible = False: picture1(cdado).Left = x2: picture1(cdado).Top = y2: _
        picture1(cdado).Picture = picture1(0).Picture: _
        picture1(cdado).Visible = True: _
        cmesa(cdado) = -1: _
        ultimabaza = 0: ultimapuesta = -1: caidahecha = -1: _
        j2(p).Visible = False: j2(p).Left = x3: j2(p).Top = y3: _
        j2(p).Picture = picture1(0).Picture: _
        ccogidas(2) = ccogidas(2) + 5: lcartas(2) = "Cartas: " & ccogidas(2): _
        ccogidas(1) = ccogidas(1) - 2: lcartas(1) = "Cartas: " & ccogidas(1): _
        Call comprobar_si_siguiente(jugador2(p), 2): jugador2(p) = -1: _
        picture1(16).Visible = True: _
        For x2 = 1 To 2: picture1(16).Visible = False: _
        x = picture1(16).Left: y = picture1(16).Top: picture1(6).Visible = True: _
        Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): _
        picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y: _
        Next x2: Call colocar_cartas
        
If Not (dado) Then ultimapuesta = jugador1(Index) _
        : Call poner_en_tablero(jugador1(Index), Index, 1): caidahecha = -1
     
     jugador1(Index) = -1
     If comprobar_si_mesa_limpia And ultimabaza = 1 Then tjug(1).Text = "Mesa limpia": ccogidas(1) = ccogidas(1) + 1: cturno(1) = cturno(1) + 1: _
             ccogidas(2) = ccogidas(2) - 1: _
             picture1(15).Visible = True: x = picture1(15).Left: y = picture1(15).Top: Call mover_carta_a_otra(picture1(15), picture1(16), picture1(15).Left, picture1(15).Top): picture1(15).Visible = False: picture1(15).Left = x: picture1(15).Top = y
     If comprobar_si_mesa_limpia And ultimabaza = 2 Then ccogidas(1) = ccogidas(1) - 1: picture1 _
             (16).Visible = True: x = picture1(65).Left: y = picture1(16).Top: Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y: _
 
 Call actualizar_marcador
Call retardo(5000)
Call colocar_cartas
 If turno_acabado And total > 5 Then Timer1.Enabled = False: Call iniciar_jugadores

fin:
End Sub

Private Sub Timer1_Timer()
Dim ocdado(1 To 3) As Byte
Dim odado(1 To 3) As Boolean
Dim cuenta(1 To 3) As Integer
Dim t, p As Integer
Dim x, y, x2, y2 As Integer
Dim x3 As Integer
Dim y3 As Integer
Dim e As Integer
Timer1.Enabled = False
If turno = 0 Or acabado = 1 Then GoTo fin
MDIForm1.jn.Enabled = False


ini: If vicente = 1 Then GoTo fin: Call colocar_cartas

For t = 1 To 3
cuenta(t) = 0
If jugador2(t) > 0 Then Call comprobar_si_coges(jugador2(t), cmesa, ocdado(t), odado(t)): _
    If odado(t) = True Then cuenta(t) = cuenta(t) + 1: Call contar_siguientes(jugador2(t), cuenta(t))


Next t


gen: p = Int(Rnd(1) * 3) + 1
If jugador2(p) <= 0 Then GoTo gen

If cuenta(1) > cuenta(2) And jugador2(1) > 0 Then p = 1 Else _
    If cuenta(2) > cuenta(1) And jugador2(2) > 0 Then p = 2
If cuenta(3) > cuenta(p) And jugador2(3) > 0 Then p = 3

'si no hay para coger
If (odado(1) = False Or jugador2(1) <= 0) And (odado(2) = False Or jugador2(2) <= 0) _
    And (odado(3) = False Or jugador2(3) <= 0) Then Call buscar_mejor_sin_coger(p)
        

For t = 1 To 3
If ultimapuesta Mod 13 = jugador2(t) Mod 13 And jugador2(t) <> -1 Then p = t
Next
Call retardo(3800)
j2(p).Picture = LoadResPicture(jugador2(p), 0)

Call retardo(3800)
x = j2(p).Left
y = j2(p).Top
x2 = picture1(ocdado(p)).Left
y2 = picture1(ocdado(p)).Top
cturno(2) = 0
salidas(jugador2(p) Mod 13) = salidas(jugador2(p) Mod 13) + 1


tjug(2).Text = ""
If Not (odado(p)) Then caidahecha = -1: ultimapuesta = jugador2(p): Call poner_en_tablero(jugador2(p), p, 2) Else _
            Call mover_carta_a_otra(j2(p), picture1(ocdado(p)), j2(p).Left, j2(p).Top): _
            Call mirar_si_caida(2, jugador2(p)): _
            Call si_sobrecaida2(jugador2(p), p, e, x3, y3): _
            If sobrecaida >= 0 Then Call si_sanvicente2(jugador2(p), p) Else If _
            jugador2(p) = -1 Then GoTo ini Else _
            If ncuelgue = 1 Then turno = 1: Timer1.Enabled = True: GoTo fin2 Else If sobrecaida = _
            -1 Then Call mover_carta_a_otra( _
            j2(p), picture1(0), picture1(ocdado(p)).Left, picture1(ocdado(p)).Top): Call mover_carta_a_otra( _
            picture1(ocdado(p)), picture1(0), picture1(ocdado(p)).Left, picture1(ocdado(p)).Top): ultimapuesta = - _
            1: j2(p _
            ).Visible = False: j2(p).Left = x: j2(p).Top = y: j2(p _
            ).Picture = picture1(0).Picture: _
            picture1(ocdado _
            (p)).Visible = False: picture1(ocdado(p)).Left = x2: picture1(ocdado(p)).Top = y2: picture1(ocdado _
            (p)).Picture = picture1(0).Picture: picture1(ocdado _
            (p)).Visible = True: ultimabaza = 0 _
            : If ocdado( _
            p) > 0 Then cmesa(ocdado(p)) = -1: Call retardo( _
            2000): ccogidas(2 _
            ) = ccogidas(2) + 2: cturno(2) = cturno(2) + 2: lcartas(2).Caption = "Cartas: " & ccogidas(2): Call comprobar_si_siguiente( _
            jugador2(p), 2)
            
            
            
            
            jugador2(p) = -1:
            If comprobar_si_mesa_limpia Then tjug(2).Text = "Mesa limpia": ccogidas(2) = ccogidas(2) + 1: cturno(2) = cturno(2) + 1: _
                ccogidas(1) = ccogidas(1) - 1: lcartas(1).Caption = "Cartas: " & ccogidas(1): _
                 picture1(16).Visible = True: x = picture1(16).Left: y = picture1(16).Top: Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y: _
                lcartas(2).Caption = "Cartas: " & ccogidas(2)
fin2: If turno_acabado And total > 5 Then Call iniciar_jugadores
fin: turno = 0: If ncuelgue = 1 Then turno = 1: ncuelgue = 0

MDIForm1.jn.Enabled = True
End Sub

Private Sub tinicio_Timer()
Dim c As Integer
Dim g As Byte

For g = 1 To 4
c = generarcarta
Call repetida(c, g)
Next
tinicio.Enabled = False

Call iniciar_jugadores
End Sub

Public Sub comprobar_si_coges(ByVal valor1 As Integer, ByVal cmesa, ByRef cdado As Byte, ByRef dado As Boolean)
Dim h As Integer
h = 1
dado = False
While Not (dado) And h < 14
    If cmesa(h) Mod 13 = valor1 Mod 13 Then _
        dado = True: cdado = h _
    Else: h = h + 1
    
Wend

End Sub

Public Sub poner_en_tablero(ByVal valor As Integer, ByVal pos As Byte, ByVal jugador As Integer)
Dim x, y, xt, yt, t As Integer
Dim aux As Byte

aux = Int(Rnd(1) * 13) + 1
While cmesa(aux) > 0 And aux < 14

    aux = Int(Rnd(1) * 13) + 1
    
Wend

If jugador = 1 Then x = j1(pos).Left: y = j1(pos).Top: _
    xt = picture1(aux).Left - x: yt = picture1(aux).Top - y: _
       For t = 1 To 10: _
        DoEvents: _
        j1(pos).Left = j1(pos).Left + xt / 10: _
        j1(pos).Top = j1(pos).Top + yt / 10: _
        Next t: _
        j1(pos).Left = picture1(aux).Left: j1(pos).Top = picture1(aux).Top: _
        picture1(aux).Picture = LoadResPicture(valor, 0): _
        j1(pos).Visible = False: _
        j1(pos).Picture = picture1(0).Picture: _
        jugador1(pos) = -1: _
        j1(pos).Left = x: j1(pos).Top = y: _
        j1(pos).Visible = True
        
If jugador = 1 Or jugador = 2 Then cmesa(aux) = valor

If jugador = 2 Then x = j2(pos).Left: y = j2(pos).Top: _
    xt = picture1(aux).Left - x: yt = picture1(aux).Top - y: _
       For t = 1 To 10: _
        DoEvents: _
        j2(pos).Left = j2(pos).Left + xt / 10: _
        j2(pos).Top = j2(pos).Top + yt / 10: _
        Next: _
        j2(pos).Left = picture1(aux).Left: j2(pos).Top = picture1(aux).Top: _
        picture1(aux).Picture = LoadResPicture(valor, 0): _
        j2(pos).Visible = False: _
        j2(pos).Picture = picture1(0).Picture: _
        jugador2(pos) = -1: _
        j2(pos).Left = x: j2(pos).Top = y: _
        j2(pos).Visible = True
End Sub

Public Sub comprobar_si_siguiente(ByVal valor As Integer, ByVal jugador As Integer)
Dim h As Byte
For h = 1 To 13
    If cmesa(h) Mod 13 = (valor + 1) Mod 13 And cmesa(h) > 0 Then Call retardo(7000): _
         Call dibujar_cogida(h, jugador): _
          cmesa(h) = -1: _
    ccogidas(jugador) = ccogidas(jugador) + 1: _
    cturno(jugador) = cturno(jugador) + 1: _
    lcartas(jugador).Caption = "Cartas: " & ccogidas(jugador): _
    Call comprobar_si_siguiente(valor + 1, jugador)
    
Next h

End Sub

Public Sub contar_siguientes(ByVal valor As Integer, ByRef cuenta As Integer)
Dim h As Byte
Dim cogida As Boolean
cogida = False
h = 1
While h < 14 And Not (cogida)
    If cmesa(h) Mod 13 = (valor + 1) Mod 13 And cmesa(h) > 0 Then _
    cogida = True: _
    cuenta = cuenta + 1: _
    Call contar_siguientes(valor + 1, cuenta)
h = h + 1
Wend


End Sub


Public Function turno_acabado()
Dim b, i, x, y As Integer

turno_acabado = (jugador1(1) <= 0 And jugador1(2) <= 0 And jugador1(3) <= 0 And jugador2(1) <= 0 And jugador2(2) <= 0 And jugador2(3) <= 0)
If turno_acabado And rondapagada = False Then: _
    If rondin(1) > rondin(2) Then ccogidas(1) = ccogidas(1) + 2: ccogidas(2) = ccogidas(2) - 2: tjug(1).Text = "Pagame el rondín": lcartas(1).Caption = "Cartas: " & ccogidas(1): For i = 1 To 2: picture1(15).Visible = True: x = picture1(15).Left: y = picture1(15).Top: Call mover_carta_a_otra(picture1(15), picture1(16), picture1(15).Left, picture1(15).Top): picture1(15).Visible = False: picture1(15).Left = x: picture1(15).Top = y: Next i Else _
    If rondin(2) > rondin(1) Then ccogidas(2) = ccogidas(2) + 2: ccogidas(1) = ccogidas(1) - 2: tjug(2).Text = "Pagame el rondín": rondapagada = True: lcartas(2).Caption = "Cartas: " & ccogidas(2): For i = 1 To 2: picture1(16).Visible = True: x = picture1(16).Left: y = picture1(16).Top: Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y: Next i Else _
    If ronda(1) > ronda(2) Then ccogidas(1) = ccogidas(1) + 1: ccogidas(2) = ccogidas(2) - 1: tjug(1).Text = "Pagame la ronda": rondapagada = True: lcartas(1).Caption = "Cartas: " & ccogidas(1): picture1(15).Visible = True: x = picture1(15).Left: y = picture1(15).Top: Call mover_carta_a_otra(picture1(15), picture1(16), picture1(15).Left, picture1(15).Top): picture1(15).Visible = False: picture1(15).Left = x: picture1(15).Top = y Else _
    If ronda(2) > ronda(1) Then ccogidas(2) = ccogidas(2) + 1: ccogidas(1) = ccogidas(1) - 1: tjug(2).Text = "Pagame la ronda": rondapagada = True: lcartas(2).Caption = "Cartas: " & ccogidas(2): picture1(16).Visible = True: x = picture1(16).Left: y = picture1(16).Top: Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y

If turno_acabado And total < 6 Then: _
    Call Coger_ultimas
If turno_acabado Then Call colocar_cartas
End Function

Public Sub retardo(ByVal ret As Integer)
Dim t As Integer
Timer1.Enabled = False
    For t = 1 To ret
    Print ""
    Next t
Timer1.Enabled = True
End Sub

Public Sub comprobar_si_ronda_rondin(ByRef jugador As Variant, ByRef rondin As Variant, ByRef ronda As Variant, ByVal numero As Byte)
If jugador(1) Mod 13 = jugador(2) Mod 13 And jugador(2) Mod 13 = jugador(3) Mod 13 Then rondin(numero) = jugador(1) Mod 13 _
    Else: If jugador(1) Mod 13 = jugador(2) Mod 13 Or jugador(1) Mod 13 = jugador(3) Mod 13 Then ronda(numero) = jugador(1) Mod _
        13 Else: If jugador(3) Mod 13 = jugador(2) Mod 13 Then ronda(numero) = jugador(2) Mod 13
    
    
End Sub

Public Function comprobar_si_mesa_limpia()
Dim i As Byte
Dim mesa, salir As Boolean
salir = False
mesa = False
i = 1
While Not (salir) And cmesa(i) = -1
    i = i + 1
    If i = 13 Then salir = True
Wend
If salir And cmesa(13) = -1 Then mesa = True
comprobar_si_mesa_limpia = mesa
End Function

Public Sub mover_carta_a_otra(ByVal origen As PictureBox, ByVal destino As PictureBox, ByVal x, y As Integer)
Dim xt, yt As Integer
Dim t As Byte

DoEvents

xt = destino.Left - x
yt = destino.Top - y


For t = 1 To 10
    DoEvents
    origen.Left = origen.Left + xt / 11
    origen.Top = origen.Top + yt / 11
Next t

End Sub

Public Sub dibujar_cogida(ByVal h As Integer, ByVal jugador As Byte)
Dim x, y As Integer

x = picture1(h).Left: y = picture1(h).Top
If jugador = 1 Then Call mover_carta_a_otra(picture1(h), picture1(14), picture1(h).Left, picture1(h).Top): _
                 picture1(h).Visible = False: picture1(h).Left = x: picture1(h).Top = y: _
                 picture1(h).Picture = picture1(0).Picture: _
                 picture1(h).Visible = True Else:: _
Call mover_carta_a_otra(picture1(h), picture1(0), picture1(h).Left, picture1(h).Top): picture1( _
                  h).Visible = False: picture1(h).Left = x: picture1(h).Top = y: picture1( _
                  h).Picture = picture1(0).Picture: picture1( _
                  h).Visible = True: _

End Sub

Public Sub Coger_ultimas()
Timer1.Enabled = False
Dim b As Integer
  For b = 1 To 13
        If cmesa(b) > 0 And ultimabaza = 0 Then Call mover_carta_a_otra(picture1(b), picture1(0), picture1(b).Left, picture1(b).Top): _
                        ccogidas(2) = ccogidas(2) + 1: lcartas(2).Caption = "Cartas: " & ccogidas(2) Else _
                        : If cmesa(b) > 0 And ultimabaza = 1 Then Call mover_carta_a_otra(picture1(b), picture1(14), picture1(b).Left, picture1(b).Top): _
                        ccogidas(1) = ccogidas(1) + 1: lcartas(1).Caption = "Cartas: " & ccogidas(1): _
   
   Next b
   Call decir_ganador
End Sub

Public Sub caida(ByVal jugador As Integer)
Dim x, y As Integer

If jugador = 1 Then _
      ccogidas(1) = ccogidas(1) + 1: cturno(1) = cturno(1) + 1: _
    ccogidas(2) = ccogidas(2) - 1: _
    tjug(1).Text = "Caida": _
    picture1(15).Visible = True: _
    x = picture1(15).Left: y = picture1(15).Top: _
    Call mover_carta_a_otra(picture1(15), picture1(16), picture1(15).Left, picture1(15).Top): _
    picture1(15).Visible = False: picture1(15).Left = x: picture1(15).Top = y Else _
    ccogidas(2) = ccogidas(2) + 1: cturno(2) = cturno(2) + 1: _
    ccogidas(1) = ccogidas(1) - 1: _
    tjug(2).Text = "Caida": _
    picture1(16).Visible = True: _
    x = picture1(16).Left: y = picture1(16).Top: _
    Call mover_carta_a_otra(picture1(16), picture1(15), picture1(16).Left, picture1(16).Top): _
    picture1(16).Visible = False: picture1(16).Left = x: picture1(16).Top = y

Call actualizar_marcador
End Sub

Public Sub mirar_si_caida(ByVal jugador As Integer, ByVal c As Integer)
If ultimapuesta Mod 13 = c Mod 13 Then caidahecha = c: Call caida(jugador): ultimapuesta = -1 Else caidahecha = -1

End Sub

Public Sub comenzar_juego()
Dim a, m, r As Byte
vicente = 0

ncuelgue = 0
poscar(1, 1) = j2(1).Left
poscar(1, 2) = j2(1).Top
poscar(2, 1) = j2(2).Left
poscar(2, 2) = j2(2).Top
poscar(3, 1) = j2(3).Left
poscar(3, 2) = j2(3).Top

For r = 1 To 13
pospu(r, 1) = picture1(r).Left
pospu(r, 2) = picture1(r).Top
Next r


Timer1.Enabled = False
For m = 1 To 3
jugador1(m) = -1
jugador2(m) = -1

j1(m).Picture = picture1(0).Picture
j2(m).Picture = picture1(0).Picture
Next

For a = 1 To 13
salidas(a) = 0
picture1(a).Picture = picture1(0).Picture
cmesa(a) = -1
Next
total = 52
For a = 1 To total
cartas(a) = a
Next

tinicio.Enabled = True
Call actualizar_marcador
tjug(1).Text = ""
tjug(2).Text = ""
ccogidas(1) = 0
ccogidas(2) = 0

End Sub

Public Sub decir_ganador()
Dim c As Class1
Set c = New Class1
Dim a
Call actualizar_marcador

If ccogidas(1) > ccogidas(2) Then a = MsgBox("Enhorabuena has ganado, ¿Quiere jugar de nuevo?", vbYesNo, "Resultados") Else _
    If ccogidas(2) > ccogidas(1) Then a = MsgBox("Ja!!! te ha ganado el ordenador,¿Quiere jugar de nuevo?", vbYesNo, "Resultados") Else _
        a = MsgBox("Que aburrimiento, un empate,¿Quiere jugar de nuevo?", vbYesNo, "Resultados")
  'Unload Form1
 If a = 7 Then End:
 If a = 6 Then Call retardo(2000): Call c.iniciar
'acabado = 1
        
End Sub

Public Sub buscar_mejor_sin_coger(ByRef mejor As Integer)
Dim h(1 To 3) As Integer
Dim t As Byte

mejor = -1
For t = 1 To 3
h(t) = -1
If jugador2(t) > 0 Then h(t) = salidas(jugador2(t) Mod 13)
Next
If h(1) > h(2) Then mejor = 1 Else mejor = 2
    If h(mejor) < h(3) Then mejor = 3
         
End Sub

Public Sub si_sobrecaida(ByVal car As Integer, ByVal i As Integer, _
                        ByRef p As Integer, ByRef x2 As Integer, ByRef y2 As Integer)
Dim t As Integer
p = -1
If (jugador2(1) Mod 13 = car Mod 13) And caidahecha > 0 Then p = 1 Else _
    If (jugador2(2) Mod 13 = car Mod 13) And caidahecha > 0 Then p = 2 Else _
        If (jugador2(3) Mod 13 = car Mod 13) And caidahecha > 0 Then p = 3

If p > 0 Then _
    sobrecaida = caidahecha: _
    j2(p).Picture = LoadResPicture(jugador2(p), 0): _
    Call retardo(3000): _
    x2 = j2(p).Left: _
    y2 = j2(p).Top: _
    Call mover_carta_a_otra(j2(p), j1(i), j2(p).Left, j2(p).Top):
    
    
End Sub
Public Sub si_sobrecaida2(ByVal car As Integer, ByVal i As Integer, _
                        ByRef p As Integer, ByRef x2 As Integer, ByRef y2 As Integer)
Dim t, g As Integer
p = -1
'If (jugador1(1) Mod 13 = car Mod 13) And caidahecha > 0 Then cartasobre = 1 Else _
 '   If (jugador1(2) Mod 13 = car Mod 13) And caidahecha > 0 Then cartasobre = 2 Else _
  '      If (jugador1(3) Mod 13 = car Mod 13) And caidahecha > 0 Then cartasobre = 3 Else GoTo fin
        
If (jugador2(1) = car) And caidahecha > 0 Then cartasobre = 1 Else _
    If (jugador2(2) = car) And caidahecha > 0 Then cartasobre = 2 Else _
        If (jugador2(3) = car) And caidahecha > 0 Then cartasobre = 3
        

For t = 1 To 5000
DoEvents
g = g + 1

Next t
fin:


End Sub



Public Sub colocar_cartas()
Dim r As Integer
 j2(1).Left = poscar(1, 1)
 j2(1).Top = poscar(1, 2)
j2(2).Left = poscar(2, 1)
 j2(2).Top = poscar(2, 2)
j2(3).Left = poscar(3, 1)
 j2(3).Top = poscar(3, 2)
For r = 1 To 3
j1(r).Visible = True
j2(r).Visible = True
Next

For r = 1 To 13
picture1(r).Left = pospu(r, 1)
picture1(r).Top = pospu(r, 2)
Next r
End Sub

Public Sub actualizar_marcador()
lcartas(1).Caption = "Cartas: " & ccogidas(1)
lcartas(2).Caption = "Cartas: " & ccogidas(2)
End Sub

Public Sub si_sanvicente(ByVal carta As Integer, ByVal i As Integer)
Dim r, s As Integer
r = -1
For s = 1 To 3
If carta Mod 13 = jugador2(s) Mod 13 Then r = s
Next s
If r >= 0 Then Call mover_carta_a_otra(j2(r), j1(i), j2(r).Left, j2(r).Top): _
tjug(2).Text = "San Vicente": vicente = 1: _
j2(r).Picture = LoadResPicture(jugador2(r), 0): _
ccogidas(1) = 0: ccogidas(2) = 52: Call actualizar_marcador: Call decir_ganador

End Sub

Public Sub si_sanvicente2(ByVal carta As Integer, ByVal i As Integer)
Dim f, g As Integer



For f = 1 To 3
If (jugador1(f) Mod 13 = carta Mod 13) And i <> f Then vicenteposible = f
Next

        

If vicenteposible > 0 Then For f = 1 To 5000: _
DoEvents: _
g = g + 1: _
Next f:
vicenteposible = 0
End Sub
